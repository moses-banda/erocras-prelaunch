<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iphone</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Ambient Background Layer -->
    <div class="ambient-background">
        <!-- Belt 1 (Top) - Left to Right -->
        <div class="belt-row belt-top">
            <div class="belt-track track-left">
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
            </div>
        </div>
        <!-- Belt 2 (Middle) - Right to Left -->
        <div class="belt-row belt-middle">
            <div class="belt-track track-right">
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
            </div>
        </div>
        <!-- Belt 3 (Bottom) - Left to Right -->
        <div class="belt-row belt-bottom">
            <div class="belt-track track-left">
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
            </div>
        </div>
    </div>

    <div class="container" data-tilt>
        <div class="iphone">
            <div class="notch">
                <div class="speaker"></div>
                <div class="camera"></div>
            </div>

            <!-- Screen 1: Incoming Call -->
            <div id="incoming-call" class="screen incoming-call active">
                <div class="call-info">
                    <p class="call-status">INCOMING CALL</p>
                    <div class="avatar-container">
                        <img src="snaps/caller.jpg" alt="Caller Avatar" class="avatar pulse">
                    </div>
                    <h1 class="caller-name">911 for Careers</h1>
                    <p class="caller-sub">On-demand career advice when stuck</p>
                </div>

                <div class="call-actions">
                    <div class="action-btn decline" onclick="handleDecline()">
                        <div class="icon-circle red">
                            <span style="font-size: 24px; font-weight: bold;">?</span>
                        </div>
                        <span style="width:100px; text-align:center; line-height: 1.2;">See What Happens</span>
                    </div>
                    <div class="action-btn accept" onclick="handleAccept()">
                        <div class="icon-circle green">
                            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik0yMC4wMSAxNS4zOGMtMS4yMyAwLTIuNDItLjItMy41My0uNTYtLjM1LS4xMi0uNzQtLjAzLTEuMDEuMjRsLTEuNTMgMS41M2MtMi43MS0xLjQzLTQuOTItMy42My02LjM2LTYuMzZsMS41My0xLjUzYy4yNi0uMjYuMzYtLjY1LjI0LTEuMDItLjM2LTEuMTEtLjU2LTIuMy0uNTYtMy41MyAwLS41NC0uNDUtLjk5LS45OS0uOTlINC4xOWMtLjU0IDAtLjk5LjQ1LS45OS45OUMzLjIgMTMuNzEgOC40NiAxOSAxOC4wMSAxOWMuNTQgMCAuOTktLjQ1Ljk5LS45OXYtMy42M2MtLjAxLS41NS0uNDYtMS0xLS45OXoiLz48L3N2Zz4="
                                alt="Accept">
                        </div>
                        <span>Accept</span>
                    </div>
                </div>
            </div>

            <!-- Screen 2: Waitlist (WhatsApp Style) -->
            <div id="waitlist-chat" class="screen waitlist-chat">
                <div class="chat-header">
                    <div class="back-btn" onclick="goBackToCall()">â€¹</div>
                    <div class="chat-info">
                        <img src="snaps/caller.jpg" alt="Avatar" class="header-avatar">
                        <div class="header-text">
                            <h2>Waitlist</h2>
                            <p>162 members</p>
                        </div>
                    </div>
                </div>

                <div class="chat-body" id="chatBody">
                    <div class="date-bubble">Today 9:41 AM</div>

                    <div class="message received">
                        <img src="snaps/caller.jpg" class="msg-avatar">
                        <div class="bubble">
                            Type your email to join the waitlist
                        </div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <div class="camera-icon">ðŸ“·</div>
                    <!-- wrapper for input to position suggestions relative to it if needed, or just absolute -->
                    <div style="flex: 1; position: relative;">
                        <input type="email" placeholder="Type your email..." id="emailInput" autocomplete="off">
                        <div id="autocomplete-list" class="autocomplete-suggestions"></div>
                    </div>
                    <div class="send-btn" onclick="submitEmail()">âž¤</div>
                </div>
            </div>

            <!-- Screen 3: Decline Options (Hidden/Unused now, simplified to No flow) -->
            <div id="decline-options" class="screen decline-options">
                <div class="response-container">
                    <h2>Leave a message?</h2>
                    <p>The user is currently busy.</p>
                    <button class="msg-option" onclick="goBackToCall()">Return directly to call</button>
                </div>
            </div>

            <div class="butt1"></div>
        </div>
    </div>

    <script>
        function handleAccept() {
            document.getElementById('incoming-call').classList.remove('active');
            document.getElementById('waitlist-chat').classList.add('active');
        }

        function handleDecline() {
            // Trigger "See What Happens" / "No" flow
            document.getElementById('incoming-call').classList.remove('active');
            const chatScreen = document.getElementById('waitlist-chat');
            const chatBody = document.getElementById('chatBody');

            chatScreen.classList.add('active');

            // 1. Insert "No" message (Simulated user response)
            setTimeout(() => {
                chatBody.innerHTML += `
                    <div class="message sent fade-in">
                        <div class="bubble">Just exploring...</div>
                    </div>
                `;
                chatBody.scrollTop = chatBody.scrollHeight;

                // 2. Wait 600ms
                setTimeout(() => {
                    startQuoteSequence(chatBody);
                }, 600);
            }, 300);
        }

        const quotes = [
            "We get it. It's confusing out there.",
            "Most students don't realize the problem until it's too late.",
            "But you don't have to figure it out alone."
        ];

        function startQuoteSequence(chatBody) {
            let delay = 0;
            // Optionally dim background
            document.querySelector('.ambient-background').classList.add('dimmed');

            quotes.forEach((quote, index) => {
                setTimeout(() => {
                    chatBody.innerHTML += `
                        <div class="message received quote-msg fade-slide-in">
                             <img src="snaps/caller.jpg" class="msg-avatar">
                            <div class="bubble">${quote}</div>
                        </div>
                    `;
                    chatBody.scrollTop = chatBody.scrollHeight;
                }, delay);
                delay += 2000; // Increased delay for reading
            });
        }

        function goBackToCall() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('incoming-call').classList.add('active');
            document.querySelector('.ambient-background').classList.remove('dimmed');
            // In a real app we might reset the chat content here
        }

        function submitEmail() {
            const email = document.getElementById('emailInput').value;
            if (email) {
                const chatBody = document.getElementById('chatBody');
                chatBody.innerHTML += `
                    <div class="message sent">
                        <div class="bubble">${email}</div>
                    </div>
                `;
                document.getElementById('emailInput').value = '';
                document.getElementById('autocomplete-list').classList.remove('visible'); // Hide suggestions

                setTimeout(() => {
                    chatBody.innerHTML += `
                    <div class="message received">
                         <img src="snaps/caller.jpg" class="msg-avatar">
                        <div class="bubble">Thanks! You've been added.</div>
                    </div>
                `;
                    chatBody.scrollTop = chatBody.scrollHeight;
                }, 1000);
            }
        }

        // Email Autocomplete Logic
        const emailInput = document.getElementById('emailInput');
        const suggestionsBox = document.getElementById('autocomplete-list');
        const domains = ['gmail.com', 'outlook.com', 'yahoo.com', 'vanderbilt.edu', 'edu'];

        emailInput.addEventListener('input', function (e) {
            const val = this.value;
            suggestionsBox.innerHTML = '';
            suggestionsBox.classList.remove('visible');

            if (!val || !val.includes('@')) return;

            const parts = val.split('@');
            if (parts.length !== 2) return; // Only trigger if one '@' exists and typing after it

            const prefix = parts[0];
            const domainPart = parts[1];

            const matches = domains.filter(d => d.startsWith(domainPart));

            if (matches.length > 0) {
                matches.forEach(domain => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';

                    // Highlight the match
                    // Text: prefix + @ + domain
                    // Display: prefix@ + (bold) domain suffix match?
                    // Let's just bold the suggested part
                    const matchSuffix = domain.substring(domainPart.length);
                    item.innerHTML = `${prefix}@${domainPart}<span class="suggestion-match">${matchSuffix}</span>`;

                    item.addEventListener('click', function () {
                        emailInput.value = prefix + '@' + domain;
                        suggestionsBox.classList.remove('visible');
                        emailInput.focus();
                    });

                    suggestionsBox.appendChild(item);
                });
                suggestionsBox.classList.add('visible');
            }
        });

        // Hide on click outside
        document.addEventListener('click', function (e) {
            if (e.target !== emailInput && e.target !== suggestionsBox) {
                suggestionsBox.classList.remove('visible');
            }
        });

        // Keyboard navigation
        emailInput.addEventListener('keydown', function (e) {
            if (!suggestionsBox.classList.contains('visible')) return;

            const items = suggestionsBox.querySelectorAll('.suggestion-item');
            if (items.length === 0) return;

            let current = Array.from(items).findIndex(i => i.classList.contains('selected'));

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (current < items.length - 1) current++;
                else current = 0;
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (current > 0) current--;
                else current = items.length - 1;
            } else if (e.key === 'Enter' || e.key === 'Tab') {
                if (current > -1) {
                    e.preventDefault();
                    items[current].click();
                } else if (items.length > 0 && e.key === 'Tab') {
                    // Tab selects first if none selected
                    e.preventDefault();
                    items[0].click();
                }
                return;
            } else {
                return;
            }

            items.forEach(i => i.classList.remove('selected'));
            if (current > -1) items[current].classList.add('selected');
        });

    </script>
</body>

</html>