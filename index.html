<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iphone</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Ambient Background Layer -->
    <div class="ambient-background">

        <!-- Belt 1 (Top) - Left to Right -->
        <div class="belt-row belt-top">
            <div class="belt-track track-left">
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_ej1olrej1olrej1o (1).png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_hokqn2hokqn2hokq (4).png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_js31y9js31y9js31.png"></div>

                <!-- repeat for seamless loop -->
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_ej1olrej1olrej1o (1).png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_hokqn2hokqn2hokq (4).png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_js31y9js31y9js31.png"></div>
            </div>
        </div>

        <!-- Belt 2 (Middle) - Right to Left -->
        <div class="belt-row belt-middle">
            <div class="belt-track track-right">
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_io2noio2noio2noi (1).png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_io2noio2noio2noi (2).png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_io2noio2noio2noi (3).png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>

                <!-- repeat -->
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_io2noio2noio2noi (1).png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_io2noio2noio2noi (2).png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_io2noio2noio2noi (3).png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
            </div>
        </div>

        <!-- Belt 3 (Bottom) - Left to Right -->
        <div class="belt-row belt-bottom">
            <div class="belt-track track-left">
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_nr3psfnr3psfnr3p.png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_y70w37y70w37y70w.png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_ej1olrej1olrej1o (1).png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>

                <!-- repeat -->
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_nr3psfnr3psfnr3p.png"></div>
                <div class="belt-item"><img src="snaps/bg1.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_y70w37y70w37y70w.png"></div>
                <div class="belt-item"><img src="snaps/bg2.png"></div>
                <div class="belt-item"><img src="snaps/Gemini_Generated_Image_ej1olrej1olrej1o (1).png"></div>
                <div class="belt-item"><img src="snaps/bg3.png"></div>
            </div>
        </div>

    </div>


    <div class="container" data-tilt>
        <div class="iphone">
            <div class="btns"></div>
            <div class="notch">
                <div class="speaker"></div>
                <div class="camera"></div>
            </div>

            <!-- Screen 1: Incoming Call -->
            <div id="incoming-call" class="screen incoming-call active">
                <div class="call-info">
                    <p class="call-status">INCOMING CALL</p>
                    <div class="avatar-container">
                        <img src="snaps/caller.jpg" alt="Caller Avatar" class="avatar pulse">
                    </div>
                    <h1 class="caller-name">911 for Careers</h1>
                    <p class="caller-sub">On-demand career advice when stuck</p>
                </div>

                <div class="call-actions">
                    <div class="action-btn decline" onclick="handleDecline()">
                        <div class="icon-circle red">
                            <span class="question-mark">?</span>
                        </div>
                        <span class="btn-label">Erocras</span>
                    </div>
                    <div class="action-btn accept" onclick="handleAccept()">
                        <div class="icon-circle green">
                            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPjxwYXRoIGQ9Ik0yMC4wMSAxNS4zOGMtMS4yMyAwLTIuNDItLjItMy41My0uNTYtLjM1LS4xMi0uNzQtLjAzLTEuMDEuMjRsLTEuNTMgMS41M2MtMi43MS0xLjQzLTQuOTItMy42My02LjM2LTYuMzZsMS41My0xLjUzYy4yNi0uMjYuMzYtLjY1LjI0LTEuMDItLjM2LTEuMTEtLjU2LTIuMy0uNTYtMy41MyAwLS41NC0uNDUtLjk5LS45OS0uOTlINC4xOWMtLjU0IDAtLjk5LjQ1LS45OS45OUMzLjIgMTMuNzEgOC40NiAxOSAxOC4wMSAxOWMuNTQgMCAuOTktLjQ1Ljk5LS45OXYtMy42M2MtLjAxLS41NS0uNDYtMS0xLS45OXoiLz48L3N2Zz4="
                                alt="Accept">
                        </div>
                        <span class="btn-label">Accept</span>
                    </div>
                </div>
            </div>

            <!-- Screen 2: Waitlist (WhatsApp Style) -->
            <div id="waitlist-chat" class="screen waitlist-chat">
                <div class="chat-header">
                    <div class="back-btn" onclick="goBackToCall()">‹</div>
                    <div class="chat-info">
                        <img src="snaps/caller.jpg" alt="Avatar" class="header-avatar">
                        <div class="header-text">
                            <h2>Waitlist</h2>
                            <p>162 members</p>
                        </div>
                    </div>
                </div>

                <div class="chat-body" id="chatBody">
                    <div class="date-bubble">Today 9:41 AM</div>

                    <div class="message received">
                        <img src="snaps/caller.jpg" class="msg-avatar">
                        <div class="bubble">
                            Type your email to join the waitlist
                        </div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <div class="camera-icon"></div>
                    <!-- wrapper for input to position suggestions relative to it if needed, or just absolute -->
                    <div style="flex: 1; position: relative;">
                        <input type="email" placeholder="Type your email..." id="emailInput" autocomplete="off">
                        <div id="autocomplete-list" class="autocomplete-suggestions"></div>
                    </div>
                    <div class="send-btn" onclick="submitEmail()">➤</div>
                </div>
            </div>

            <!-- Screen 3: Decline Options (Hidden/Unused now, simplified to No flow) -->
            <div id="decline-options" class="screen decline-options">
                <div class="response-container">
                    <h2>Leave a message?</h2>
                    <p>The user is currently busy.</p>
                    <button class="msg-option" onclick="goBackToCall()">Return directly to call</button>
                </div>
            </div>

            <div class="butt1"></div>
        </div>
    </div>

    <script>
        // Initialize state
        document.querySelector('.iphone').classList.add('ringing');

        function handleAccept() {
            document.querySelector('.iphone').classList.remove('ringing');
            document.getElementById('incoming-call').classList.remove('active');
            document.getElementById('waitlist-chat').classList.add('active');
        }

        function handleDecline() {
            document.querySelector('.iphone').classList.remove('ringing');
            // Trigger "See What Happens" / "No" flow
            document.getElementById('incoming-call').classList.remove('active');
            const chatScreen = document.getElementById('waitlist-chat');
            const chatBody = document.getElementById('chatBody');

            chatScreen.classList.add('active');

            // 1. Insert "No" message (Simulated user response)
            setTimeout(() => {
                chatBody.innerHTML += `
                    <div class="message sent fade-in">
                        <div class="bubble">Just exploring...</div>
                    </div>
                `;
                chatBody.scrollTop = chatBody.scrollHeight;

                // 2. Wait 600ms
                setTimeout(() => {
                    startQuoteSequence(chatBody);
                }, 600);
            }, 300);
        }

        const stories = [
            { text: "This is Charlie before his important coffee chat...", img: "snaps/problem_charlie.png" },
            { text: "Sarah during her midterms, overwhelmed and alone...", img: "snaps/problem_sarah.png" },
            { text: "And Alex, facing another rejection without guidance...", img: "snaps/problem_alex.png" }
        ];

        let storyIndex = 0;
        let homeTimeout = null;

        function startQuoteSequence(chatBody) {
            document.querySelector('.ambient-background').classList.add('dimmed');
            showNextStory();
        }

        function showNextStory() {
            const chatBody = document.getElementById('chatBody');
            if (storyIndex >= stories.length) return;

            const story = stories[storyIndex];

            // 1. Show Text
            setTimeout(() => {
                const textMsg = document.createElement('div');
                textMsg.className = 'message received fade-slide-in';
                textMsg.innerHTML = `
                    <img src="snaps/caller.jpg" class="msg-avatar">
                    <div class="bubble">${story.text}</div>
                `;
                chatBody.appendChild(textMsg);
                chatBody.scrollTop = chatBody.scrollHeight;

                // 2. Show Image after delay
                setTimeout(() => {
                    const imgMsg = document.createElement('div');
                    imgMsg.className = 'message received fade-slide-in';
                    imgMsg.innerHTML = `
                        <img src="snaps/caller.jpg" class="msg-avatar">
                        <div class="bubble" style="padding: 5px;">
                            <img src="${story.img}" class="msg-image">
                        </div>
                    `;
                    chatBody.appendChild(imgMsg);
                    chatBody.scrollTop = chatBody.scrollHeight;

                    storyIndex++;

                    // Determine next step
                    if (storyIndex === 1) {
                        // Midway option after 1st story
                        setTimeout(showMidwayOption, 1500);
                    } else if (storyIndex === 2) {
                        // Ask back to home after 2nd story
                        setTimeout(askBackToHome, 1500);
                    } else if (storyIndex < stories.length) {
                        // Keep going
                        setTimeout(showNextStory, 3000);
                    }
                }, 1500);
            }, 1000);
        }

        function showMidwayOption() {
            const chatBody = document.getElementById('chatBody');
            const option = document.createElement('div');
            option.className = 'story-option';
            option.innerText = "See more stories";
            option.onclick = () => {
                option.remove();
                showNextStory();
            };
            chatBody.appendChild(option);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function askBackToHome() {
            const chatBody = document.getElementById('chatBody');
            const question = document.createElement('div');
            question.className = 'message received fade-slide-in';
            question.innerHTML = `
                <img src="snaps/caller.jpg" class="msg-avatar">
                <div class="bubble">Do you want to go back to home?</div>
            `;
            chatBody.appendChild(question);

            const options = document.createElement('div');
            options.style.display = 'flex';
            options.style.gap = '10px';
            options.style.justifyContent = 'center';
            options.innerHTML = `
                <div class="story-option" id="yesHome">Yes</div>
                <div class="story-option" id="noHome">No</div>
            `;
            chatBody.appendChild(options);
            chatBody.scrollTop = chatBody.scrollHeight;

            document.getElementById('yesHome').onclick = () => {
                clearTimeout(homeTimeout);
                goBackToCall();
            };

            document.getElementById('noHome').onclick = () => {
                clearTimeout(homeTimeout);
                options.remove();
                showNextStory();
            };

            // 7 Second Timeout
            homeTimeout = setTimeout(() => {
                options.remove();
                showNextStory();
            }, 7000);
        }

        function goBackToCall() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('incoming-call').classList.add('active');
            document.querySelector('.ambient-background').classList.remove('dimmed');
            // In a real app we might reset the chat content here
        }

        function submitEmail() {
            const emailInput = document.getElementById('emailInput');
            const email = emailInput.value.trim();

            // Regex: name@domain.com or name@domain.edu
            const emailRegex = /^[^\s@]+@[^\s@]+\.(com|edu)$/i;

            if (email && emailRegex.test(email)) {
                const chatBody = document.getElementById('chatBody');
                chatBody.innerHTML += `
                    <div class="message sent">
                        <div class="bubble">${email}</div>
                    </div>
                `;
                emailInput.value = '';
                document.getElementById('autocomplete-list').classList.remove('visible'); // Hide suggestions

                setTimeout(() => {
                    chatBody.innerHTML += `
                    <div class="message received">
                         <img src="snaps/caller.jpg" class="msg-avatar">
                        <div class="bubble">Thanks! You've been added.</div>
                    </div>
                `;
                    chatBody.scrollTop = chatBody.scrollHeight;
                }, 1000);
            } else if (email) {
                // Shake input or show brief error if invalid
                emailInput.style.border = '2px solid red';
                setTimeout(() => emailInput.style.border = 'none', 1000);
            }
        }

        // Email Autocomplete Logic
        const emailInput = document.getElementById('emailInput');
        const suggestionsBox = document.getElementById('autocomplete-list');
        const domains = ['gmail.com', 'outlook.com', 'yahoo.com', 'vanderbilt.edu', 'edu'];

        emailInput.addEventListener('input', function (e) {
            const val = this.value;
            suggestionsBox.innerHTML = '';
            suggestionsBox.classList.remove('visible');

            if (!val || !val.includes('@')) return;

            const parts = val.split('@');
            if (parts.length !== 2) return; // Only trigger if one '@' exists and typing after it

            const prefix = parts[0];
            const domainPart = parts[1];

            const matches = domains.filter(d => d.startsWith(domainPart));

            if (matches.length > 0) {
                matches.forEach(domain => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';

                    // Highlight the match
                    // Text: prefix + @ + domain
                    // Display: prefix@ + (bold) domain suffix match?
                    // Let's just bold the suggested part
                    const matchSuffix = domain.substring(domainPart.length);
                    item.innerHTML = `${prefix}@${domainPart}<span class="suggestion-match">${matchSuffix}</span>`;

                    item.addEventListener('click', function () {
                        emailInput.value = prefix + '@' + domain;
                        suggestionsBox.classList.remove('visible');
                        emailInput.focus();
                    });

                    suggestionsBox.appendChild(item);
                });
                suggestionsBox.classList.add('visible');
            }
        });

        // Hide on click outside
        document.addEventListener('click', function (e) {
            if (e.target !== emailInput && e.target !== suggestionsBox) {
                suggestionsBox.classList.remove('visible');
            }
        });

        // Keyboard navigation
        emailInput.addEventListener('keydown', function (e) {
            if (!suggestionsBox.classList.contains('visible')) return;

            const items = suggestionsBox.querySelectorAll('.suggestion-item');
            if (items.length === 0) return;

            let current = Array.from(items).findIndex(i => i.classList.contains('selected'));

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (current < items.length - 1) current++;
                else current = 0;
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (current > 0) current--;
                else current = items.length - 1;
            } else if (e.key === 'Enter' || e.key === 'Tab') {
                if (current > -1) {
                    e.preventDefault();
                    items[current].click();
                } else if (items.length > 0 && e.key === 'Tab') {
                    // Tab selects first if none selected
                    e.preventDefault();
                    items[0].click();
                }
                return;
            } else {
                return;
            }

            items.forEach(i => i.classList.remove('selected'));
            if (current > -1) items[current].classList.add('selected');
        });

    </script>
</body>

</html>